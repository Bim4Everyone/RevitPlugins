<core:WpfUIPlatformWindow
    x:Class="RevitRefreshLinks.Views.UpdateLinksWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:core="clr-namespace:dosymep.WpfUI.Core"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
    xmlns:me="clr-namespace:dosymep.WpfCore.MarkupExtensions;assembly=dosymep.WpfCore"
    xmlns:local="clr-namespace:RevitRefreshLinks.Views"
    xmlns:vms="clr-namespace:RevitRefreshLinks.ViewModels"
    xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
    xmlns:wpfbehaviors="clr-namespace:dosymep.WpfCore.Behaviors;assembly=dosymep.WpfCore"
    mc:Ignorable="d"
    WindowStartupLocation="CenterOwner"
    Height="450"
    Width="800"
    MinHeight="400"
    MinWidth="600"
    d:DataContext="{d:DesignInstance vms:UpdateLinksViewModel, IsDesignTimeCreatable=False}">

    <i:Interaction.Behaviors>
        <wpfbehaviors:WpfAttachServiceBehavior
            AttachableService="{Binding ProgressDialogFactory}" />
    </i:Interaction.Behaviors>
    <i:Interaction.Triggers>
        <i:EventTrigger
            EventName="Loaded">
            <i:InvokeCommandAction
                Command="{Binding LoadViewCommand}" />
        </i:EventTrigger>
    </i:Interaction.Triggers>
    <Window.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary
                    Source="Styles.xaml" />
            </ResourceDictionary.MergedDictionaries>
            <TextBlock
                x:Key="NameColumnHeader"
                Text="{me:LocalizationSource UpdateLinksWindow.List.LinkName.Header}"
                TextWrapping="Wrap" />
            <TextBlock
                x:Key="WorksetColumnHeader"
                Text="{me:LocalizationSource UpdateLinksWindow.List.Workset.Header}"
                TextWrapping="Wrap" />
            <TextBlock
                x:Key="LinkStatusColumnHeader"
                Text="{me:LocalizationSource UpdateLinksWindow.List.Link.Header}"
                TextWrapping="Wrap" />
            <TextBlock
                x:Key="SourceColumnHeader"
                Text="{me:LocalizationSource UpdateLinksWindow.List.Source.Header}"
                TextWrapping="Wrap" />
            <Style
                TargetType="FrameworkElement"
                x:Key="VisibleOnExecuting">
                <Style.Triggers>
                    <DataTrigger
                        Binding="{Binding DataContext.SelectServerSourceCommand.IsExecuting,
                        RelativeSource={RelativeSource AncestorType=Window}}"
                        Value="True">
                        <Setter
                            Property="Visibility"
                            Value="Visible" />
                    </DataTrigger>
                </Style.Triggers>
                <Setter
                    Property="Visibility"
                    Value="Hidden" />
            </Style>
            <Style
                TargetType="FrameworkElement"
                x:Key="HiddenOnExecuting">
                <Style.Triggers>
                    <DataTrigger
                        Binding="{Binding DataContext.SelectServerSourceCommand.IsExecuting,
                        RelativeSource={RelativeSource AncestorType=Window}}"
                        Value="True">
                        <Setter
                            Property="Visibility"
                            Value="Hidden" />
                    </DataTrigger>
                </Style.Triggers>
                <Setter
                    Property="Visibility"
                    Value="Visible" />
            </Style>
            <Style
                TargetType="Border"
                x:Key="HiddenOnExecutingBorder"
                BasedOn="{StaticResource CustomBorder}">
                <Style.Triggers>
                    <DataTrigger
                        Binding="{Binding DataContext.SelectServerSourceCommand.IsExecuting,
                        RelativeSource={RelativeSource AncestorType=Window}}"
                        Value="True">
                        <Setter
                            Property="Visibility"
                            Value="Hidden" />
                    </DataTrigger>
                </Style.Triggers>
                <Setter
                    Property="Visibility"
                    Value="Visible" />
            </Style>
        </ResourceDictionary>
    </Window.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition
                Height="Auto" />
            <RowDefinition
                Height="Auto" />
            <RowDefinition
                Height="*" />
            <RowDefinition
                Height="Auto" />
        </Grid.RowDefinitions>

        <ui:TitleBar
            Grid.Row="0"
            Title="{me:LocalizationSource UpdateLinksWindow.Title}" />

        <DockPanel
            Grid.Row="1"
            Grid.RowSpan="3"
            Style="{StaticResource VisibleOnExecuting}"
            VerticalAlignment="Center"
            HorizontalAlignment="Center">
            <ProgressBar
                IsIndeterminate="True">
            </ProgressBar>
        </DockPanel>

        <Border
            Margin="5"
            Grid.Row="1"
            Style="{StaticResource HiddenOnExecutingBorder}">
            <StackPanel>
                <DockPanel
                    VerticalAlignment="Center"
                    Margin="0 0 0 2">
                    <ui:Button
                        Content="{ui:SymbolIcon Symbol=Folder20}"
                        ToolTip="{me:LocalizationSource UpdateLinksWindow.Buttons.SelectLocalFolder}"
                        Command="{Binding SelectLocalSourceCommand}" />
                    <ui:TextBlock
                        Margin="5 0"
                        TextWrapping="NoWrap"
                        VerticalAlignment="Center"
                        Text="{me:LocalizationSource UpdateLinksWindow.LocalFolder}" />
                    <ui:TextBlock
                        TextWrapping="NoWrap"
                        VerticalAlignment="Center"
                        FontWeight="SemiBold"
                        Text="{Binding SelectedLocalSource}"
                        ToolTip="{Binding SelectedLocalSource}" />
                </DockPanel>
                <DockPanel
                    VerticalAlignment="Center">
                    <ui:Button
                        Content="{ui:SymbolIcon Symbol=Folder20}"
                        ToolTip="{me:LocalizationSource UpdateLinksWindow.Buttons.SelectServerFolder}"
                        Command="{Binding SelectServerSourceCommand}" />
                    <ui:TextBlock
                        Margin="5 0"
                        TextWrapping="NoWrap"
                        VerticalAlignment="Center"
                        Text="{me:LocalizationSource UpdateLinksWindow.ServerFolder}" />
                    <ui:TextBlock
                        TextWrapping="NoWrap"
                        VerticalAlignment="Center"
                        FontWeight="SemiBold"
                        Text="{Binding SelectedServerSource}"
                        ToolTip="{Binding SelectedServerSource}" />
                </DockPanel>
            </StackPanel>
        </Border>

        <Border
            Margin="5"
            Grid.Row="2"
            Style="{StaticResource HiddenOnExecutingBorder}">
            <DockPanel
                LastChildFill="True">

                <DockPanel
                    DockPanel.Dock="Top"
                    HorizontalAlignment="Left">
                    <ui:Button
                        Content="{ui:SymbolIcon Symbol=SelectAllOn20}"
                        ToolTip="{me:LocalizationSource UpdateLinksWindow.List.Button.SelectAll}"
                        Command="{Binding SelectAllLinksCommand}" />
                    <ui:Button
                        Margin="5 0"
                        Content="{ui:SymbolIcon Symbol=SelectAllOff20}"
                        ToolTip="{me:LocalizationSource UpdateLinksWindow.List.Button.UnselectAll}"
                        Command="{Binding UnselectAllLinksCommand}" />
                    <ui:Button
                        Content="{ui:SymbolIcon Symbol=ArrowSort20}"
                        ToolTip="{me:LocalizationSource UpdateLinksWindow.List.Button.Invert}"
                        Command="{Binding InvertSelectedLinksCommand}" />
                </DockPanel>

                <ui:DataGrid
                    Margin="0 5 0 0"
                    AutoGenerateColumns="False"
                    HorizontalScrollBarVisibility="Auto"
                    ItemsSource="{Binding LinksToUpdate}">
                    <ui:DataGrid.Columns>
                        <DataGridCheckBoxColumn
                            CanUserResize="False"
                            Binding="{Binding IsSelected, UpdateSourceTrigger=PropertyChanged}">
                            <DataGridCheckBoxColumn.ElementStyle>
                                <Style
                                    BasedOn="{StaticResource DefaultCheckBoxStyle}"
                                    TargetType="CheckBox">
                                    <Setter
                                        Property="Focusable"
                                        Value="False" />
                                    <Setter
                                        Property="IsEnabled"
                                        Value="False" />
                                    <Style.Triggers>
                                        <DataTrigger
                                            Binding="{Binding CanSelect}"
                                            Value="True">
                                            <Setter
                                                Property="IsEnabled"
                                                Value="True" />
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </DataGridCheckBoxColumn.ElementStyle>
                            <DataGridCheckBoxColumn.EditingElementStyle>
                                <Style
                                    BasedOn="{StaticResource DefaultCheckBoxStyle}"
                                    TargetType="CheckBox">
                                    <Setter
                                        Property="Focusable"
                                        Value="True" />
                                </Style>
                            </DataGridCheckBoxColumn.EditingElementStyle>
                        </DataGridCheckBoxColumn>
                        <DataGridTextColumn
                            IsReadOnly="True"
                            Width="*"
                            CellStyle="{StaticResource CustomDataGridCell}"
                            Binding="{Binding NameWithExtension}"
                            Header="{StaticResource NameColumnHeader}" />
                        <DataGridTextColumn
                            IsReadOnly="True"
                            Width="Auto"
                            CanUserResize="False"
                            Binding="{Binding DisplayWorksetStatus}"
                            Header="{StaticResource WorksetColumnHeader}" />
                        <DataGridTextColumn
                            IsReadOnly="True"
                            Width="Auto"
                            CanUserResize="False"
                            Binding="{Binding DisplayLinkStatus}"
                            Header="{StaticResource LinkStatusColumnHeader}" />
                        <DataGridTextColumn
                            IsReadOnly="True"
                            Width="Auto"
                            CanUserResize="False"
                            Binding="{Binding SourceStatus}"
                            Header="{StaticResource SourceColumnHeader}" />
                    </ui:DataGrid.Columns>
                </ui:DataGrid>
            </DockPanel>
        </Border>

        <StackPanel
            Grid.Row="3"
            Orientation="Horizontal"
            HorizontalAlignment="Right"
            Style="{StaticResource HiddenOnExecuting}">
            <ui:TextBlock
                Margin="10"
                Style="{StaticResource CustomErrorText}"
                Text="{Binding ErrorText}" />

            <ui:Button
                Margin="10"
                Width="80"
                IsDefault="True"
                Click="ButtonOk_Click"
                Appearance="Info"
                Content="{me:LocalizationSource AllWindow.Ok}"
                Command="{Binding AcceptViewCommand}" />

            <ui:Button
                Margin="10"
                Width="80"
                IsCancel="True"
                Content="{me:LocalizationSource AllWindow.Cancel}"
                Click="ButtonCancel_Click" />
        </StackPanel>
    </Grid>
</core:WpfUIPlatformWindow>
